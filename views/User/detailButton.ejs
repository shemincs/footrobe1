<!DOCTYPE HTML>
<html>

<head>
	<title>Footwear - Free Bootstrap 4 Template by Colorlib</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,600,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Rokkitt:100,300,400,700" rel="stylesheet">

	<!-- Animate.css -->
	<link rel="stylesheet" href="/assets/css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="/assets/css/icomoon.css">
	<!-- Ion Icon Fonts-->
	<link rel="stylesheet" href="/assets/css/ionicons.min.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="/assets/css/bootstrap.min.css">

	<!-- Magnific Popup -->
	<link rel="stylesheet" href="/assets/css/magnific-popup.css">

	<!-- Flexslider  -->
	<link rel="stylesheet" href="/assets/css/flexslider.css">

	<!-- Owl Carousel -->
	<link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
	<link rel="stylesheet" href="/assets/css/owl.theme.default.min.css">

	<!-- Date Picker -->
	<link rel="stylesheet" href="/assets/css/bootstrap-datepicker.css">
	<!-- Flaticons  -->
	<link rel="stylesheet" href="/assets/fonts/flaticon/font/flaticon.css">

	<!-- Theme style  -->
	<link rel="stylesheet" href="/assets/css/style.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css">


</head>

<body>

	<div class="colorlib-loader"></div>

	<div id="page">
		<nav class="colorlib-nav" role="navigation">
			<div class="top-menu">
				<div class="container">
					<div class="row">
						<div class="col-sm-7 col-md-9">
							<div id="colorlib-logo"><a href="index.html">Footwear</a></div>
						</div>
						<div class="col-sm-5 col-md-3">
							<form action="#" class="search-wrap">
								<div class="form-group">
									<input type="search" class="form-control search" placeholder="Search">
									<button class="btn btn-primary submit-search text-center" type="submit"><i
											class="icon-search"></i></button>
								</div>
							</form>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12 text-left menu-1">
							<ul>
								<li><a href="/">Home</a></li>
								<li class="has-dropdown">
									<a href="/mensPage">Men</a>
									<ul class="dropdown active">
										<li><a href="product-detail.html">Product Detail</a></li>
										<li><a href="cart.html">Shopping Cart</a></li>
										<li><a href="checkout.html">Checkout</a></li>
										<li><a href="order-complete.html">Order Complete</a></li>
										<li><a href="add-to-wishlist.html">Wishlist</a></li>
									</ul>
								</li>
								<li><a href="women.html">Women</a></li>
								
								<li><a href="about.html">About</a></li>
								<li><a href="/myAccount">Account</a></li>
								<li class="cart"><a href="/Cart"><i class="icon-shopping-cart"></i> Cart [0]</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
			<div class="sale">
				<div class="container">
					<div class="row">
						<div class="col-sm-8 offset-sm-2 text-center">
							<div class="row">
								<div class="owl-carousel2">
									<div class="item">
										<div class="col">
											<h3><a href="#">25% off (Almost) Everything! Use Code: Summer Sale</a></h3>
										</div>
									</div>
									<div class="item">
										<div class="col">
											<h3><a href="#">Our biggest sale yet 50% off all summer shoes</a></h3>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</nav>

		<div class="breadcrumbs">
			<div class="container">
				<div class="row">
					<div class="col">
						<p class="bread"><span><a href="index.html">Home</a></span> / <span>Purchase Complete</span></p>
					</div>
				</div>
			</div>
		</div>


		<div class="colorlib-product">
			<div class="container">
				<div class="row row-pb-lg">
					<div class="col-sm-10 offset-md-1">
						<div class="process-wrap">
							<!-- <div class="process text-center active">
								<p><span>01</span></p>
								<h3>Shopping Cart</h3>
							</div> -->
							<!-- <div class="process text-center active">
								<p><span>02</span></p>
								<h3>Checkout</h3>
							</div> -->
							<!-- <div class="process text-center active">
								<p><span>03</span></p>
								<h3>Order Complete</h3>
							</div> -->
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-10 offset-sm-1 text-center">
						<p class="icon-addcart"><span><i class="icon-check"></i></span></p>
						<h2 class="mb-4">Thank you for your order</h2>
						<p>
							<a href="/" class="btn btn-primary btn-outline-primary">Home</a>
							<a href="/cart" class="btn btn-primary btn-outline-primary"><i
									class="icon-shopping-cart"></i> Continue Shopping</a>
						</p>
					</div>
				</div>
				<div class="table-responsive">
					<table class="table" >
					<thead>
					  <tr>
						<td>Image</td>
						<th>Product Name</th>
						<th>Quantity</th>
						<th>staus</th>
						<th>SalesPrice</th>
						<th>Total</th>
					  </tr>
					</thead>
				  
					<tbody>
					  <% if (order2.product_details && order2.product_details.length > 0) { %>
						<% order2.product_details.forEach(product => { %>
						  <tr>
							<td>
								<img src="/adminassets/products/<%= product.image %>" style="height: 100px;"  alt="" srcset=""> 
							</td>
							<td><%= product.productName %></td>
							<td><%= product.Quantity %></td>
							<td><%= order2.
								delivery_status %></td>
							<td><%= product.SalesPrice %></td>
							<td><%= order2.total_price %></td>
							<td>
								<button class="cancelOrderButton" id="cancel" style="background-color: red; color: white;" data-order-id="<%= order2._id %>" data-product-id="<%= product.productId %>">Cancel Order</button>
								<button class="returnOrderButton" id="return" style="background-color: red; color: white;" data-order-id="<%= order2._id %>" data-product-id="<%= product.productId %>">Return</button>
								<button class="returnOrderButton" id="generateInvoice" style="background-color: red; color: white;" data-order-id="<%= order2._id %>">Invoice</button>

							</td>
							
						  </tr>
						<% }); %>
					  <% } else { %>
						<tr>
						  <td colspan="6">No product details found</td>
						</tr>
					  <% } %>
					  
					</tbody>
					
					
				  </table>
				  
				</div>

				  
			</div>
		</div>

		<footer id="colorlib-footer" role="contentinfo">
			<div class="container">
				<div class="row row-pb-md">
					<div class="col footer-col colorlib-widget">
						<h4>About Footwear</h4>
						<p>Even the all-powerful Pointing has no control about the blind texts it is an almost
							unorthographic life</p>
						<p>
						<ul class="colorlib-social-icons">
							<li><a href="#"><i class="icon-twitter"></i></a></li>
							<li><a href="#"><i class="icon-facebook"></i></a></li>
							<li><a href="#"><i class="icon-linkedin"></i></a></li>
							<li><a href="#"><i class="icon-dribbble"></i></a></li>
						</ul>
						</p>
					</div>
					<div class="col footer-col colorlib-widget">
						<h4>Customer Care</h4>
						<p>
						<ul class="colorlib-footer-links">
							<li><a href="#">Contact</a></li>
							<li><a href="#">Returns/Exchange</a></li>
							<li><a href="#">Gift Voucher</a></li>
							<li><a href="#">Wishlist</a></li>
							<li><a href="#">Special</a></li>
							<li><a href="#">Customer Services</a></li>
							<li><a href="#">Site maps</a></li>
						</ul>
						</p>
					</div>
					<div class="col footer-col colorlib-widget">
						<h4>Information</h4>
						<p>
						<ul class="colorlib-footer-links">
							<li><a href="#">About us</a></li>
							<li><a href="#">Delivery Information</a></li>
							<li><a href="#">Privacy Policy</a></li>
							<li><a href="#">Support</a></li>
							<li><a href="#">Order Tracking</a></li>
						</ul>
						</p>
					</div>

					<div class="col footer-col">
						<h4>News</h4>
						<ul class="colorlib-footer-links">
							<li><a href="blog.html">Blog</a></li>
							<li><a href="#">Press</a></li>
							<li><a href="#">Exhibitions</a></li>
						</ul>
					</div>

					<div class="col footer-col">
						<h4>Contact Information</h4>
						<ul class="colorlib-footer-links">
							<li>291 South 21th Street, <br> Suite 721 New York NY 10016</li>
							<li><a href="tel://1234567920">+ 1235 2355 98</a></li>
							<li><a href="mailto:info@yoursite.com">info@yoursite.com</a></li>
							<li><a href="#">yoursite.com</a></li>
						</ul>
					</div>
				</div>
			</div>
			<div class="copy">
				<div class="row">
					<div class="col-sm-12 text-center">
						<p>
							<span><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
								Copyright &copy;
								<script>document.write(new Date().getFullYear());</script> All rights reserved | This
								template is made with <i class="icon-heart" aria-hidden="true"></i> by <a
									href="https://colorlib.com" target="_blank">Colorlib</a>
								<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
							</span>
							<span class="block">Demo Images: <a href="http://unsplash.co/" target="_blank">Unsplash</a>
								, <a href="http://pexels.com/" target="_blank">Pexels.com</a></span>
						</p>
					</div>
				</div>
			</div>
		</footer>
	</div>

	<div class="gototop js-top">
		<a href="#" class="js-gotop"><i class="ion-ios-arrow-up"></i></a>
	</div>
    
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

	<!-- jQuery -->
	<script src="/assets/js/jquery.min.js"></script>
	<!-- popper -->
	<script src="/assets/js/popper.min.js"></script>
	<!-- bootstrap 4.1 -->
	<script src="/assets/js/bootstrap.min.js"></script>
	<!-- jQuery easing -->
	<script src="/assets/js/jquery.easing.1.3.js"></script>
	<!-- Waypoints -->
	<script src="/assets/js/jquery.waypoints.min.js"></script>
	<!-- Flexslider -->
	<script src="/assets/js/jquery.flexslider-min.js"></script>
	<!-- Owl carousel -->
	<script src="/assets/js/owl.carousel.min.js"></script>
	<!-- Magnific Popup -->
	<script src="/assets/js/jquery.magnific-popup.min.js"></script>
	<script src="/assets/js/magnific-popup-options.js"></script>
	<!-- Date Picker -->
	<script src="/assets/js/bootstrap-datepicker.js"></script>
	<!-- Stellar Parallax -->
	<script src="/assets/js/jquery.stellar.min.js"></script>
	<!-- Main -->
	<script src="/assets/js/main.js"></script>
	<script>
		document.querySelectorAll('.cancelOrderButton').forEach(button => {
    button.addEventListener('click', function(e) {
        e.preventDefault();

        const productId = this.dataset.productId;
        const orderId = this.dataset.orderId;

        
        console.log('Product ID:', productId);
        console.log('Order ID:', orderId);

        fetch(`/cancelOrder/${productId}/${orderId}`, {
			method:"POST"
		})
		.then((response)=>{
			if(response.status == 200)
			{
				swal.fire({
					icon:'success',
					title:"success",
					text:"Product cancelled successfully"
				}).then(() => {
                    location.reload(); // Reload the page after successful cancellation
                })
			}
			else
			{
				swal.fire({
					icon:'error',
					title:"error",
					text:"Not successfull"
				})
			}
		})
		.catch((error)=>{
			swal.fire({
					icon:'error',
					title:"error",
					text:"Internal server error"
				})
		})
    });
});
  

	</script>
	<script>
document.getElementById("return").addEventListener('click', async function(e) {
  e.preventDefault();

  const productId = this.getAttribute('data-product-id');
  const orderId = this.getAttribute('data-order-id');

  console.log('Product ID:', productId);
  console.log('Order ID:', orderId);

  try {
    const response = await fetch(`/returnOrder?id=${orderId}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ productId }) // Pass productId in the body
    });

    if (response.ok) {
      // Item returned successfully, reload the page
      window.location.reload();
    } else {
      swal.fire({
        icon: 'error',
        title: 'Error',
        text: 'Failed to return the item'
      });
    }
  } catch (error) {
    swal.fire({
      icon: 'error',
      title: 'Error',
      text: 'Internal server error'
    });
  }
});



	</script>
<!-- Your HTML -->

<script>

// Function to generate and download the invoice PDF
const generateInvoice = async (orderId) => {
  try {
    const response = await fetch(`/Invoice?_id=${orderId}`, {
      method: 'GET',
    });

    if (response.ok) {
      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);

      // Create a link element and simulate a click to trigger the download
      const a = document.createElement('a');
      a.href = url;
      a.download = 'invoice.pdf';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);

      // Clean up the URL object
      window.URL.revokeObjectURL(url);
    } else {
      // Handle error response from the server
      console.error('Failed to generate invoice');
    }
  } catch (error) {
    console.error('Error generating invoice:', error.message);
  }
};

// Event listener for the button click
const generateInvoiceButton = document.getElementById('generateInvoice');

generateInvoiceButton.addEventListener('click', async () => {
  const orderId = generateInvoiceButton.getAttribute('data-order-id');
  generateInvoice(orderId);
});

</script>

	
</body>

</html>